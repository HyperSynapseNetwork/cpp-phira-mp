# cpp-phira-mp

åŸºäº [phira-mp](https://github.com/TeamFlos/phira-mp) é‡æ–°å¼€å‘çš„C++ç‰ˆphira-mpï¼Œå¹¶æ·»åŠ äº†ä¸€äº›åŠŸèƒ½ã€‚

## æ–°å¢åŠŸèƒ½ğŸ‰

### 1. åå° Web ç®¡ç†é¢æ¿
- æµè§ˆå™¨è®¿é—® `http://æœåŠ¡å™¨IP:12345/admin`
- æŸ¥çœ‹æ‰€æœ‰æˆ¿é—´åˆ—è¡¨ã€æˆ¿é—´çŠ¶æ€ã€ç©å®¶äººæ•°åŠåˆ—è¡¨

### 2. ä¸€äº›API

| æ¥å£ | è¯´æ˜ |
|------|------|
| `GET /api/rooms/info` | è·å–æ‰€æœ‰æˆ¿é—´åˆ—è¡¨åŠå®Œæ•´æ•°æ® |
| `GET /api/rooms/info/<name>` | è·å–æŒ‡å®šåç§°æˆ¿é—´ä¿¡æ¯ |
| `GET /api/rooms/user/<user_id>` | è·å–æŒ‡å®šç”¨æˆ·æ‰€åœ¨æˆ¿é—´ä¿¡æ¯ |
| `GET /api/rooms/listen` | SSE å®æ—¶äº‹ä»¶æµ |

#### SSE äº‹ä»¶ç±»å‹
| äº‹ä»¶ | è¯´æ˜ |
|------|------|
| `create_room` | æ–°æˆ¿é—´åˆ›å»º |
| `update_room` | æˆ¿é—´æ•°æ®æ›´æ–°ï¼ˆçŠ¶æ€ã€é“ºé¢ã€é”å®šç­‰å˜åŒ–ï¼‰ |
| `join_room` | ç”¨æˆ·åŠ å…¥æˆ¿é—´ |
| `leave_room` | ç”¨æˆ·ç¦»å¼€æˆ¿é—´ |
| `player_score` | ç©å®¶å®Œæˆæ¸¸æˆï¼ˆå«å®Œæ•´æˆç»©è®°å½•ï¼‰ |
| `start_round` | æˆ¿é—´å¼€å§‹æ–°ä¸€è½®æ¸¸æˆ |

### 3. è¿æ¥æ¬¢è¿ä¿¡æ¯
- ç”¨æˆ·è®¤è¯æˆåŠŸåè‡ªåŠ¨å‘é€æ¬¢è¿æ¶ˆæ¯
- å±•ç¤ºå½“å‰å¯åŠ å…¥çš„æˆ¿é—´åˆ—è¡¨ï¼ˆä»…æ˜¾ç¤ºé€‰å›¾ä¸­ä¸”æœªé”å®šçš„æˆ¿é—´ï¼‰

---

## Ubuntu å®‰è£…ä¾èµ–

```bash
# æ›´æ–°åŒ…åˆ—è¡¨
sudo apt update

# å®‰è£…ç¼–è¯‘å·¥å…·å’Œä¾èµ–
sudo apt install -y build-essential g++ uuid-dev curl
```

### æ‰€éœ€ä¾èµ–æ¸…å•
| ä¾èµ– | Ubuntu åŒ…å | ç”¨é€” |
|------|------------|------|
| G++ (>=10) | `build-essential` / `g++` | C++20 ç¼–è¯‘å™¨ |
| uuid-dev | `uuid-dev` | UUID ç”Ÿæˆ |
| curl | `curl` | HTTP è¯·æ±‚ï¼ˆè·å– Phira API æ•°æ®ï¼‰ |
| make | `build-essential` | æ„å»ºå·¥å…· |

---

## ç¼–è¯‘

```bash
cd cpp-phira-mp-main
make clean
make
```

ç¼–è¯‘æˆåŠŸåç”Ÿæˆ `phira-mp-server` å¯æ‰§è¡Œæ–‡ä»¶ã€‚

ï¼ˆä½ å¯ä»¥ç›´æ¥ä»æœ¬ä»“åº“çš„ [Github Actions](../../actions) ä¸‹è½½å¯¹åº”æ¶æ„çš„äºŒè¿›åˆ¶Linuxå’ŒWindows.exeæ–‡ä»¶)

---

## è¿è¡Œ

```bash
# é»˜è®¤ç«¯å£è¿è¡Œï¼ˆæ¸¸æˆç«¯å£ 12346ï¼ŒWeb ç«¯å£ 12345ï¼‰
./phira-mp-server

# è‡ªå®šä¹‰ç«¯å£
./phira-mp-server -p 12346 -w 8080

# åå°è¿è¡Œ
nohup ./phira-mp-server -p 12346 -w 12345 > server.log 2>&1 &
```

### å‘½ä»¤è¡Œå‚æ•°
| å‚æ•° | è¯´æ˜ | é»˜è®¤å€¼ |
|------|------|--------|
| `-p, --port` | æ¸¸æˆæœåŠ¡å™¨ç«¯å£ | 12346 |
| `-w, --web-port` | Web ç®¡ç†/API ç«¯å£ | 12345 |
| `-h, --help` | æ˜¾ç¤ºå¸®åŠ© | - |

---

## æ–‡ä»¶ç»“æ„

```
cpp-phira-mp-main/
â”œâ”€â”€ include/
â”‚   â”œâ”€â”€ ban_manager.h      # [æ–°å¢] å°ç¦ç®¡ç†
â”‚   â”œâ”€â”€ binary_protocol.h  # äºŒè¿›åˆ¶åè®®
â”‚   â”œâ”€â”€ commands.h          # å‘½ä»¤å®šä¹‰
â”‚   â”œâ”€â”€ http_client.h       # HTTP å®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ l10n.h              # æœ¬åœ°åŒ–
â”‚   â”œâ”€â”€ room.h              # [ä¿®æ”¹] æˆ¿é—´ + è½®æ¬¡å†å²
â”‚   â”œâ”€â”€ server.h            # [ä¿®æ”¹] æœåŠ¡å™¨ + get_state()
â”‚   â”œâ”€â”€ session.h           # ä¼šè¯
â”‚   â””â”€â”€ web_server.h        # [æ–°å¢] Web æœåŠ¡å™¨
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ http_client.cpp
â”‚   â”œâ”€â”€ l10n.cpp
â”‚   â”œâ”€â”€ main.cpp            # [ä¿®æ”¹] ä¸»å…¥å£ + Web å¯åŠ¨
â”‚   â”œâ”€â”€ room.cpp            # [ä¿®æ”¹] è½®æ¬¡è®°å½• + SSE
â”‚   â”œâ”€â”€ server.cpp
â”‚   â”œâ”€â”€ session.cpp         # [ä¿®æ”¹] å°ç¦æ£€æŸ¥ + æ¬¢è¿æ¶ˆæ¯ + SSE
â”‚   â””â”€â”€ web_server.cpp      # [æ–°å¢] Web æœåŠ¡å™¨å®ç°
â”œâ”€â”€ locales/
â”‚   â”œâ”€â”€ en-US.ftl
â”‚   â”œâ”€â”€ zh-CN.ftl
â”‚   â””â”€â”€ zh-TW.ftl
â”œâ”€â”€ Makefile
â””â”€â”€ README.md
```

### è¿è¡Œæ—¶æ–‡ä»¶
- `banned.txt` â€” å°ç¦ç©å®¶ ID åˆ—è¡¨ï¼ˆè‡ªåŠ¨åˆ›å»º/ç®¡ç†ï¼‰
- `server_config.yml` â€” æœåŠ¡å™¨é…ç½®ï¼ˆå¯é€‰ï¼‰

---

## API ä½¿ç”¨ç¤ºä¾‹

```bash
# è·å–æ‰€æœ‰æˆ¿é—´
curl http://localhost:12345/api/rooms/info

# è·å–æŒ‡å®šæˆ¿é—´
curl http://localhost:12345/api/rooms/info/{roomid}

# è·å–ç”¨æˆ·æ‰€åœ¨æˆ¿é—´
curl http://localhost:12345/api/rooms/user/12345

# ç›‘å¬å®æ—¶äº‹ä»¶ï¼ˆSSEï¼‰
curl http://localhost:12345/api/rooms/listen

```

---

## QQ ç¾¤

**1049578201**

## åè®®

é‡‡ç”¨ **MIT** åè®®ã€‚
